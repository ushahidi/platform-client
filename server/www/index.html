<!doctype html>
<html lang="en" ng-strict-di>
    <head ng-controller="PageMetadata">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="/fonts/Lato/css/fonts.css" rel="stylesheet" type="text/css">
        <!-- @todo minify CSS -->
        <link rel="stylesheet" href="/css/style.css" ng-href="{{rtlEnabled ? '/css/rtl-style.css' : '/css/style.css'}}">
        <link rel="stylesheet" href="/css/vendor.css">
        <script src="/config.js"></script>

        <title ng-bind-template="{{pageTitle}} {{siteTitle}}"></title>
        <meta name="description" content="{{pageDescription}}">
        <meta name="keywords" content="{{pageKeywords}}">
        <meta name="robots" content="{{pageRobots}}">
        <base href="/">
    </head>

    <body ng-class="{ rtl : rtlEnabled }" class="has-dynamic-header" canvas>
        <div id="bootstrap-loading">
            <header class="header header-full overlay" role="banner">
                <div class="container">
                    <div class="color-overlay">
                        <div class="parallax">
                            <h1 class="beta"><i class="fa fa-refresh fa-4 fa-spin"></i></h1>
                        </div>
                    </div>
                </div>
            </header>
        </div>

        <div id="bootstrap-error" class="hidden">
            <header class="header header-full overlay" role="banner">
                <div class="container">
                    <div class="color-overlay">
                        <div class="parallax">
                            <h1 class="beta"><img style="max-width: 50px; margin: auto;" src="img/ushahidi-logo.svg" alt="Ushahidi Logo"></h1>
                        </div>
                    </div>
                </div>
            </header>
            <div class="wrapper">
                <main class="page-content">
                    <div class="alert error">
                        <p>Sorry, something went wrong. Try reloading the page.</p>
                    </div>
                </main>
            </div>
        </div>

        <div id="bootstrap-app" class="hidden">
            <header class="header header-full overlay" ng-class="{ 'header-full' : isHome, 'header-compact': !isHome }" role="banner" ng-controller="navigation">
                <div class="container">
                    <div class="hero-image" ng-if="site.image_header">
                         <img ng-src="{{site.image_header}}" alt="" />
                    </div>

                    <div class="color-overlay">
                        <div class="parallax">
                            <div class="nav-icon" off-canvas-toggle>
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                            <a ng-href="/">
                                <h1 class="beta" ng-bind="site.name"></h1>
                            </a>
                            <p class="header-description" ng-bind="site.description"></p>

                            <div class="create-admin">
                              <a class="button button-primary" ng-href="/posts/create"
                                 ng-show="canCreatePost()">
                                    <span class="icon-left fa-plus" translate>nav.add_post</span>
                                </a>

                                <ng-include src="'templates/partials/user-menu.html'"></ng-include>
                            </div>
                        </div>
                    </div>

                </div>
            </header>

            <!-- Keep .canvas separate from ng-view otherwise offcanvas behaviour breaks on view change -->
            <div class="wrapper">
                <ng-include src="'templates/partials/main-menu.html'"></ng-include>

                <ng-view></ng-view>
            </div>

            <div class="wrapper">
                <ng-include src="'templates/partials/notification-system.html'"></ng-include>
            </div>

            <footer role="contentinfo" ng-controller="navigation">
                <div class="wrapper">
                    <div class="footer-container">
                        <h2 ng-bind="site.name"></h2>
                        <p ng-bind="site.description"></p>
                        <ul class="footer-nav">
                            <li><a ng-href="/" translate>nav.home</a></li>
                            <!-- <li><a ng-href="/about" translate>nav.about</a></li> -->
                            <li><a ng-href="/activity" translate>nav.activity</a></li>
                            <li><a href="https://ushahidi.com/support" translate>app.documentation</a></li>
                            <li><a href="https://github.com/ushahidi/platform/issues/new" translate>app.report_a_bug</a></li>
                            <li><a ng-href="/tools/settings" ng-show="hasManageSettingsPermission()" translate>nav.settings</a></li>
                        </ul>
                    </div>
                </div>
            </footer>

            <first-time-config></first-time-config>
        </div>

        <script src="/js/bundle.js"></script>

        <script type="text/javascript">
            if (window.ushahidi && window.ushahidi.doorbellEnabled) {
                window.doorbellOptions = {
                    tags: ['platform'],
                    appKey: window.ushahidi.doorbellAppKey,
                    properties: {
                        apiUrl: window.ushahidi.apiUrl
                    },
                    onShow: function () {
                        injector = angular.element(document).injector();
                        auth = injector.get('Authentication');
                        session = injector.get('Session');

                        if (auth && session) {
                            doorbell.setOption('email', session.getSessionDataEntry('email'));
                            doorbell.setProperty('loggedIn', auth.getLoginStatus());
                            doorbell.setProperty('role', session.getSessionDataEntry('role'));
                            doorbell.setProperty('realname', session.getSessionDataEntry('realname'));
                        }
                    }
                };
                (function(d, t) {
                    var g = d.createElement(t);g.id = 'doorbellScript';g.type = 'text/javascript';g.async = true;g.src = 'https://embed.doorbell.io/button/2005?t='+(new Date().getTime());(d.getElementsByTagName('head')[0]||d.getElementsByTagName('body')[0]).appendChild(g);
                }(document, 'script'));
            }
        </script>
        <!--
        Intercom integration
        -->
        <script type="text/javascript">
            (function(){
              var per_app_intercom_widget;

              function getAppId() {
                if (typeof window.intercomSettings !== 'undefined' &&
                  typeof(window.intercomSettings.app_id) !== 'undefined') {
                  return window.intercomSettings.app_id
                } else if (typeof window.analytics !== 'undefined' &&
                  typeof window.analytics._integrations !== 'undefined' &&
                  typeof analytics._integrations.Intercom !== 'undefined' &&
                  typeof analytics._integrations.Intercom.options !== 'undefined' &&
                  typeof analytics._integrations.Intercom.options.appId !== 'undefined') {
                  return analytics._integrations.Intercom.options.appId;
                } else {
                  return '';
                }
              }

              per_app_intercom_widget = 'https://widget.intercom.io/widget/' + getAppId();
              var script_tag = document.createElement('script');
              script_tag.type = 'text/javascript';
              script_tag.async = true;
              script_tag.src = per_app_intercom_widget;

              var existing_script = document.getElementsByTagName('script')[0];
              existing_script.parentNode.insertBefore(script_tag, existing_script);
            })();
        </script>
        <ng-include src="'templates/partials/intercom-system.html'"></ng-include>
        
        <script>
            if (window.ushahidi && window.ushahidi.gaEnabled) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', window.ushahidi.gaKey, 'auto');
                ga('send', 'pageview');
            }
        </script>
    </body>
</html>
